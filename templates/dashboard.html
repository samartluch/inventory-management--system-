{% extends "base.html" %}

{% block title %}Dashboard - Inventory Management System{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800">Dashboard</h1>
    <p class="text-gray-600">Welcome back, {{ current_user.username }}! Here's your inventory overview.</p>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500 hover:shadow-lg transition duration-300">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-blue-100 text-blue-500 mr-4">
                <i class="fas fa-boxes text-xl"></i>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Total Products</h3>
                <p class="text-3xl font-bold text-gray-900">{{ total_products }}</p>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-green-500 hover:shadow-lg transition duration-300">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-green-100 text-green-500 mr-4">
                <i class="fas fa-check-circle text-xl"></i>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-gray-700">In Stock</h3>
                <p class="text-3xl font-bold text-gray-900">{{ total_products - low_stock - out_of_stock }}</p>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-yellow-500 hover:shadow-lg transition duration-300">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-yellow-100 text-yellow-500 mr-4">
                <i class="fas fa-exclamation-triangle text-xl"></i>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Low Stock</h3>
                <p class="text-3xl font-bold text-gray-900">{{ low_stock }}</p>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6 border-l-4 border-red-500 hover:shadow-lg transition duration-300">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-red-100 text-red-500 mr-4">
                <i class="fas fa-times-circle text-xl"></i>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Out of Stock</h3>
                <p class="text-3xl font-bold text-gray-900">{{ out_of_stock }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Stock Status Chart -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Stock Status Distribution</h2>
        <div class="h-64">
            <canvas id="stockStatusChart"></canvas>
        </div>
    </div>

    <!-- Category Distribution Chart -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Category Distribution</h2>
        <div class="h-64">
            <canvas id="categoryChart"></canvas>
        </div>
    </div>
</div>

<!-- Quick Actions & Recent Activity -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Quick Actions</h2>
        <div class="grid grid-cols-2 gap-4">
            <a href="{{ url_for('add_product') }}" class="bg-indigo-50 hover:bg-indigo-100 p-4 rounded-lg border border-indigo-200 transition duration-300 group hover-lift">
                <div class="flex items-center">
                    <i class="fas fa-plus-circle text-indigo-500 text-xl mr-3 group-hover:text-indigo-600"></i>
                    <div>
                        <span class="font-medium text-indigo-700 group-hover:text-indigo-800">Add Product</span>
                        <p class="text-xs text-indigo-600 mt-1">Add new item to inventory</p>
                    </div>
                </div>
            </a>
            <a href="{{ url_for('inventory') }}" class="bg-green-50 hover:bg-green-100 p-4 rounded-lg border border-green-200 transition duration-300 group hover-lift">
                <div class="flex items-center">
                    <i class="fas fa-boxes text-green-500 text-xl mr-3 group-hover:text-green-600"></i>
                    <div>
                        <span class="font-medium text-green-700 group-hover:text-green-800">View Inventory</span>
                        <p class="text-xs text-green-600 mt-1">Browse all products</p>
                    </div>
                </div>
            </a>
            <a href="{{ url_for('report') }}" class="bg-purple-50 hover:bg-purple-100 p-4 rounded-lg border border-purple-200 transition duration-300 group hover-lift">
                <div class="flex items-center">
                    <i class="fas fa-chart-bar text-purple-500 text-xl mr-3 group-hover:text-purple-600"></i>
                    <div>
                        <span class="font-medium text-purple-700 group-hover:text-purple-800">Generate Report</span>
                        <p class="text-xs text-purple-600 mt-1">View analytics & reports</p>
                    </div>
                </div>
            </a>
            <a href="{{ url_for('inventory') }}" class="bg-yellow-50 hover:bg-yellow-100 p-4 rounded-lg border border-yellow-200 transition duration-300 group hover-lift">
                <div class="flex items-center">
                    <i class="fas fa-edit text-yellow-500 text-xl mr-3 group-hover:text-yellow-600"></i>
                    <div>
                        <span class="font-medium text-yellow-700 group-hover:text-yellow-800">Manage Products</span>
                        <p class="text-xs text-yellow-600 mt-1">Edit or delete items</p>
                    </div>
                </div>
            </a>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-800">Recent Products</h2>
            <a href="{{ url_for('inventory') }}" class="text-sm text-indigo-600 hover:text-indigo-800">View All</a>
        </div>
        <div class="space-y-4">
            {% if recent_products %}
                {% for product in recent_products %}
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition duration-300">
                    <div class="flex items-center">
                        <div class="p-2 rounded-full 
                            {% if product.quantity == 0 %}bg-red-100 text-red-500
                            {% elif product.quantity < 10 %}bg-yellow-100 text-yellow-500
                            {% else %}bg-green-100 text-green-500{% endif %} mr-3">
                            <i class="fas fa-box"></i>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800">{{ product.name }}</h3>
                            <p class="text-sm text-gray-600">{{ product.category }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-medium text-gray-900">${{ "%.2f"|format(product.price) }}</p>
                        <p class="text-sm {% if product.quantity == 0 %}text-red-500{% elif product.quantity < 10 %}text-yellow-500{% else %}text-green-500{% endif %}">
                            Qty: {{ product.quantity }}
                        </p>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-box-open text-4xl mb-3"></i>
                    <p>No products added yet.</p>
                    <a href="{{ url_for('add_product') }}" class="text-indigo-600 hover:text-indigo-800 text-sm">Add your first product</a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Low Stock Alert Section -->
{% if low_stock_products %}
<div class="mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-6">
    <div class="flex items-center mb-4">
        <i class="fas fa-exclamation-triangle text-yellow-500 text-xl mr-3"></i>
        <h2 class="text-xl font-bold text-yellow-800">Low Stock Alert</h2>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for product in low_stock_products[:6] %}
        <div class="bg-white rounded-lg p-4 border border-yellow-200">
            <div class="flex justify-between items-start mb-2">
                <h3 class="font-medium text-gray-800">{{ product.name }}</h3>
                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">Low Stock</span>
            </div>
            <p class="text-sm text-gray-600 mb-2">{{ product.category }}</p>
            <div class="flex justify-between items-center">
                <span class="text-sm font-medium text-yellow-600">Only {{ product.quantity }} left</span>
                <a href="{{ url_for('edit_product', product_id=product.id) }}" class="text-indigo-600 hover:text-indigo-800 text-sm">Restock</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Stock Status Chart
    const stockStatusCtx = document.getElementById('stockStatusChart').getContext('2d');
    const stockStatusChart = new Chart(stockStatusCtx, {
        type: 'doughnut',
        data: {
            labels: ['In Stock', 'Low Stock', 'Out of Stock'],
            datasets: [{
                data: [
                    {{ total_products - low_stock - out_of_stock }},
                    {{ low_stock }},
                    {{ out_of_stock }}
                ],
                backgroundColor: [
                    '#10B981', // green
                    '#F59E0B', // yellow
                    '#EF4444'  // red
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = Math.round((value / total) * 100);
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });

    // Category Distribution Chart
    // This would typically come from your backend, but for now we'll use sample data
    // In a real application, you would pass category data from Flask
    const categoryCtx = document.getElementById('categoryChart').getContext('2d');
    
    // Sample category data - in real app, this should come from backend
    const categoryData = {
        'Electronics': 12,
        'Clothing': 8,
        'Food': 15,
        'Books': 6,
        'Other': 5
    };

    const categoryChart = new Chart(categoryCtx, {
        type: 'bar',
        data: {
            labels: Object.keys(categoryData),
            datasets: [{
                label: 'Products per Category',
                data: Object.values(categoryData),
                backgroundColor: [
                    '#3B82F6',
                    '#10B981',
                    '#F59E0B',
                    '#EF4444',
                    '#8B5CF6'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });

    // Refresh charts on window resize
    window.addEventListener('resize', function() {
        stockStatusChart.resize();
        categoryChart.resize();
    });
});
</script>
{% endblock %}